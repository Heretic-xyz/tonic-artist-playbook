"use strict";(self.webpackChunkdocusaurus_kit=self.webpackChunkdocusaurus_kit||[]).push([[438],{3905:(t,e,r)=>{r.d(e,{Zo:()=>u,kt:()=>p});var n=r(7294);function s(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function i(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function o(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?i(Object(r),!0).forEach((function(e){s(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function a(t,e){if(null==t)return{};var r,n,s=function(t,e){if(null==t)return{};var r,n,s={},i=Object.keys(t);for(n=0;n<i.length;n++)r=i[n],e.indexOf(r)>=0||(s[r]=t[r]);return s}(t,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(n=0;n<i.length;n++)r=i[n],e.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(t,r)&&(s[r]=t[r])}return s}var l=n.createContext({}),h=function(t){var e=n.useContext(l),r=e;return t&&(r="function"==typeof t?t(e):o(o({},e),t)),r},u=function(t){var e=h(t.components);return n.createElement(l.Provider,{value:e},t.children)},c="mdxType",f={inlineCode:"code",wrapper:function(t){var e=t.children;return n.createElement(n.Fragment,{},e)}},d=n.forwardRef((function(t,e){var r=t.components,s=t.mdxType,i=t.originalType,l=t.parentName,u=a(t,["components","mdxType","originalType","parentName"]),c=h(r),d=s,p=c["".concat(l,".").concat(d)]||c[d]||f[d]||i;return r?n.createElement(p,o(o({ref:e},u),{},{components:r})):n.createElement(p,o({ref:e},u))}));function p(t,e){var r=arguments,s=e&&e.mdxType;if("string"==typeof t||s){var i=r.length,o=new Array(i);o[0]=d;var a={};for(var l in e)hasOwnProperty.call(e,l)&&(a[l]=e[l]);a.originalType=t,a[c]="string"==typeof t?t:s,o[1]=a;for(var h=2;h<i;h++)o[h]=r[h];return n.createElement.apply(null,o)}return n.createElement.apply(null,r)}d.displayName="MDXCreateElement"},3508:(t,e,r)=>{r.r(e),r.d(e,{assets:()=>l,contentTitle:()=>o,default:()=>f,frontMatter:()=>i,metadata:()=>a,toc:()=>h});var n=r(7462),s=(r(7294),r(3905));const i={sidebar_position:1},o="Language Preferences",a={unversionedId:"tutorial-basics/language-preferences",id:"tutorial-basics/language-preferences",title:"Language Preferences",description:"While Tonic offers support for generative art to be generated by any programming language, we have found that there are a few fairly unique upsides to having the art generation code written in frontend-friendly Javascript.",source:"@site/docs/tutorial-basics/language-preferences.md",sourceDirName:"tutorial-basics",slug:"/tutorial-basics/language-preferences",permalink:"/tonic-artist-playbook/tutorial-basics/language-preferences",draft:!1,tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"playbookSidebar",previous:{title:"Artist Playbook",permalink:"/tonic-artist-playbook/category/artist-playbook"},next:{title:"Code Size Guidelines",permalink:"/tonic-artist-playbook/tutorial-basics/code-size-guidelines"}},l={},h=[{value:"&quot;Ideal&quot; Example",id:"ideal-example",level:2}],u={toc:h},c="wrapper";function f(t){let{components:e,...r}=t;return(0,s.kt)(c,(0,n.Z)({},u,r,{components:e,mdxType:"MDXLayout"}),(0,s.kt)("h1",{id:"language-preferences"},"Language Preferences"),(0,s.kt)("p",null,"While Tonic offers support for generative art to be generated by any programming language, we have found that there are a few fairly unique upsides to having the art generation code written in frontend-friendly Javascript."),(0,s.kt)("p",null,"Primary upsides of having the art generation code written in frontend-friendly Javascript:"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"It is easy to produce one file which represents the entire generative project, by inlining the Javascript into a single HTML file, which can then be cleanly stored on-chain."),(0,s.kt)("li",{parentName:"ul"},"Collectors can easily save the HTML file and open it in their web browser, without any special programming knowledge or needing to set up an environment for code execution (all that's needed is a web browser)"),(0,s.kt)("li",{parentName:"ul"},"Having a single HTML file with inlined Javascript makes it easy for the generative project code to be stored on a distributed static file storage system such as IPFS or Arweave, this means that collectors can easily run the generative project code by visiting an IPFS / Arweave link, and no additional server needs to be configured / maintained.")),(0,s.kt)("h2",{id:"ideal-example"},'"Ideal" Example'),(0,s.kt)("p",null,"Here is an example of an ideal scenario for a generative art project, this was the project code compiled for Lars Wander's ",(0,s.kt)("strong",{parentName:"p"},(0,s.kt)("a",{parentName:"strong",href:"https://tonic.xyz/collection/rhythm-and-the-machine/"},'"RHYTHM & THE MACHINE"')),":"),(0,s.kt)("details",null,(0,s.kt)("summary",null,'"Ideal Scenario" Code Sample'),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-html",metastring:'title="index.html"',title:'"index.html"'},'<html>\n  <head>\n    <title>Rhythm & the Machine</title>\n    <style type="text/css">\n      * {\n        margin: 0;\n        padding: 0;\n      }\n\n    </style>\n\n  </head>\n  <body>\n    <main>\n    </main>\n    <script id="prefix">\nconsole.log("Made by Lars Wander https://larswander.com"),console.log("Licensed under CC BY-NC-SA 4.0");const t="1.0";function e(){let t="0x";for(var e=0;e<64;e++)t+=Math.floor(16*Math.random()).toString(16);return t}const r={hash:new URL(window.location.href).searchParams.get("hash")||e()},n=256;function s(t,e,r=null,n=null){if(t.length>0&&(null==r||null==n)){if(t[0]>e)return[0,!1];if(t[t.length-1]<e)return[t.length,!1]}if((r=r??0)>(n=n??t.length))throw"illegal state";if(r===n)return[r,!1];if(r+1===n)return[(t[r],r),t[r]===e];const i=Math.floor(r/2+n/2);return t[i]>e?s(t,e,r,i):t[i]===e?[i,!0]:s(t,e,i,n)}class i{constructor(t){if("string"==typeof t){if(66!==t.length)throw new Error("Expected 64 bit base 16 hash");const e=[];for(let r=2;r<66;r+=8)e.push(parseInt(t.substring(r,r+8),16));t=e}else if(8!==t.length)throw new Error("Expected 8x 32 bit int hash");const e=function([t,e,r,n]){return function(){let s=((t|=0)+(e|=0)|0)+(n|=0)|0;return n=n+1|0,t=e^e>>>9,e=(r|=0)+(r<<3)|0,r=(r=r<<21|r>>>11)+s|0,(s>>>0)/4294967296}};this.prngA=new e(t.slice(0,4)),this.prngB=new e(t.slice(4,8)),this.init=!1,this.useA=!1}random(){if(!this.init){for(let t=0;t<1e6;t+=2)this.prngA(),this.prngB();this.init=!0}return this.useA=!this.useA,this.useA?this.prngA():this.prngB()}}class o{constructor(t,e){this.r0=new i(t);const r=()=>{let t=[];for(var e=0;e<8;e++)t.push(this.r0.random()*(1<<30)|0);return t};this.rs=Array(e-1).fill(null).map((()=>new i(r()))),this.rs.unshift(this.r0)}seed(t){if(t<0||t>=this.rs.length)throw new Error(`seed ${t} OOB`);this.r0=this.rs[t]}random(){return this.r0.random()}}const a=new o(r.hash,n),h=()=>a.random();function l(t){a.seed(t)}function u(t,e){null==e&&(e=t,t=0),null==e&&(e=1);const r=e-t;return h()*r+t}function f(t,e){return null==e&&(e=t,t=0),Math.floor(u(t,e))}function c(t){return null==t&&(t=.5),h()<t}function d(t){return t[f(t.length)]}function w(t,e){e=e??t.length;t.length>0&&Array.isArray(t[0]);const r=[...t],n=[];for(let t=0;t<e;t++){const t=r.length;if(0===t)return n;const e=int(t),s=r.splice(e,1);n.push(s[0])}return n}function p(t){let e=u(t.map((([t,e])=>t)).reduce(((t,e)=>t+e)));for(let[r,n]of t){if(r>=e)return n;e-=r}return t[t.length-1][1]}function m(t,e){return null==t&&null==e?(t=new g,e=new g(1,1)):null!=t&&null==e&&(e=t,t=new g),new g(u(t.x,e.x),u(t.y,e.y))}class g{constructor(t,e){if(isNaN(t))if(null==t)this.x=0,this.y=0;else if(t instanceof g)this.x=t.x,this.y=t.y;else{if(!(t instanceof Array))throw new Error(`Bad initializer P2(${t}, ${e})`);this.x=t[0],this.y=t[1]}else this.x=t,this.y=e}reflect(t,e){const r=e.x-t.x;if(0===r)return new g(2*t.x-this.x,this.y);const n=(e.y-t.y)/r,s=e.y-n*e.x,i=n*n,o=i+1,a=((1-i)*this.x+2*n*this.y-2*n*s)/o,h=((i-1)*this.y+2*n*this.x+2*s)/o;return new g(a,h)}angle(){return Math.atan2(this.y,this.x)}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lerpT(t,e){return this.mul(1-e).add(t.mul(e))}lerpD(t,e){const r=this.dist(t);return 0===r?new g(this.x,this.y):this.lerpT(t,e/r)}add(t){return new g(this.x+t.x,this.y+t.y)}sub(t){return new g(this.x-t.x,this.y-t.y)}mul(t){return new g(this.x*t,this.y*t)}div(t){return new g(this.x/t,this.y/t)}rotate(t){const e=Math.cos(t),r=Math.sin(t);return new g(this.x*e-this.y*r,this.x*r+this.y*e)}rotateAround(t,e){return this.sub(t).rotate(e).add(t)}dist(t){if(null==t)return Math.hypot(this.x,this.y);{const e=this.x-t.x,r=this.y-t.y;return Math.hypot(e,r)}}normalize(){const t=this.dist();return 0===t?new g(0,0):this.div(t)}tl(t){return new g(Math.min(this.x,t.x),Math.min(this.y,t.y))}br(t){return new g(Math.max(this.x,t.x),Math.max(this.y,t.y))}eq(t,e=1e-6){if(!t)return!1;const r=this.sub(t);return r.x*r.x+r.y*r.y<e*e}round(){return new g(Math.round(this.x),Math.round(this.y))}ceil(){return new g(Math.ceil(this.x),Math.ceil(this.y))}floor(){return new g(Math.floor(this.x),Math.floor(this.y))}min(){return Math.min(this.x,this.y)}max(){return Math.max(this.x,this.y)}inRect(t,e){return this.x>=t.x&&this.x<e.x&&this.y>=t.y&&this.y<e.y}}class b{constructor(t,e,r){this.x=t,this.y=e,this.z=r}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}}function x(t,e,r,n,s=0){const i=new g(s,s),o=e.sub(t),a=n.sub(r).sub(i.mul(2)),h=a.x/o.x,l=a.y/o.y,u=Math.min(h,l),f=o.mul(u),c=a.sub(f).mul(.5);return{scaleFactor:u,offset:r.add(i).add(c)}}function y(t,e,r,n,s=0){const{scaleFactor:i,offset:o}=x(t,e,r,n,s);return e=>null==e?null:isNaN(e)?"string"==typeof e?e:e.sub(t).mul(i).add(o):e*i}class E{constructor(t=[],e={}){this.points=t,this.meta=e,this.distCache=[],this.rebuildCache()}rebuildCache(){if(this.distCache.length=this.points.length,0===this.points.length)return;let t=0,e=0,r=this.points[e];for(this.distCache[e]=t,e=1;e<this.points.length;e++){const n=this.points[e];t+=r.dist(n),this.distCache[e]=t,r=n}}#t(){this.distCache.length!==this.points.length&&this.rebuildCache()}push(t){return this.points.push(t),this}dist(){return this.#t(),this.distCache[this.distCache.length-1]??0}_param(t){if(0===this.points.length)return;if(t<0||t>1)throw new Error(`t out of bounds ${t}`);this.#t();const e=this.dist()*t,[r,n]=s(this.distCache,e);if(n)return[this.points[r],r,n];if(r>=this.points.length-1)throw new Error(`Point out of bounds: t = ${t}; ${r} >= ${this.points.length} - 1`);const i=this.points[r],o=this.points[r+1],a=this.distCache[r];return[i.lerpD(o,e-a),r,n]}param(t){return this._param(t)?.at(0)}paramDt(t,e=.01){const r=Math.max(0,t-e/2),n=Math.min(1,t+e/2),s=this.param(r);return this.param(n).sub(s).div(n-r)}seg(t,e){if(0===this.points.length)return;if(t<0||t>e||e>1)throw new Error(`t0, t1 out of bounds ${[t,e]}`);const[r,n,s]=this._param(t),[i,o,a]=this._param(e),h=[r];let l=a?o:o+1;for(let t=n+1;t<l;t++)h.push(this.points[t]);return h.push(i),new E(h,{...this.meta})}map(t){return new E(this.points.map(t),{...this.meta})}tl(){return 0===this.points.length?new g(1/0,1/0):this.points.reduce(((t,e)=>t.tl(e)))}br(){return 0===this.points.length?new g(-1/0,-1/0):this.points.reduce(((t,e)=>t.br(e)))}}var R=[new b(1,1,0),new b(-1,1,0),new b(1,-1,0),new b(-1,-1,0),new b(1,0,1),new b(-1,0,1),new b(1,0,-1),new b(-1,0,-1),new b(0,1,1),new b(0,-1,1),new b(0,1,-1),new b(0,-1,-1)],A=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],M=new Array(512),_=new Array(512);function B(t){t>0&&t<1&&(t*=65536),(t=Math.floor(t))<256&&(t|=t<<8);for(var e=0;e<256;e++){var r;r=1&e?A[e]^255&t:A[e]^t>>8&255,M[e]=M[e+256]=r,_[e]=_[e+256]=R[r%12]}}B(0);var L=.5*(Math.sqrt(3)-1),T=(3-Math.sqrt(3))/6,I=1/3,P=1/6;function S(t,e){var r,n,s=(t+e)*L,i=Math.floor(t+s),o=Math.floor(e+s),a=(i+o)*T,h=t-i+a,l=e-o+a;h>l?(r=1,n=0):(r=0,n=1);var u=h-r+T,f=l-n+T,c=h-1+2*T,d=l-1+2*T,w=_[(i&=255)+M[o&=255]],p=_[i+r+M[o+n]],m=_[i+1+M[o+1]],g=.5-h*h-l*l,x=.5-u*u-f*f,y=.5-c*c-d*d;return 70*((g<0?0:(g*=g)*g*w.dot(new b(h,l,0)))+(x<0?0:(x*=x)*x*p.dot(new b(u,f,0)))+(y<0?0:(y*=y)*y*m.dot(new b(c,d,0))))}function W(t,e,r){var n,s,i,o,a,h,l=(t+e+r)*I,u=Math.floor(t+l),f=Math.floor(e+l),c=Math.floor(r+l),d=(u+f+c)*P,w=t-u+d,p=e-f+d,m=r-c+d;w>=p?p>=m?(n=1,s=0,i=0,o=1,a=1,h=0):w>=m?(n=1,s=0,i=0,o=1,a=0,h=1):(n=0,s=0,i=1,o=1,a=0,h=1):p<m?(n=0,s=0,i=1,o=0,a=1,h=1):w<m?(n=0,s=1,i=0,o=0,a=1,h=1):(n=0,s=1,i=0,o=1,a=1,h=0);var g=w-n+P,x=p-s+P,y=m-i+P,E=w-o+2*P,R=p-a+2*P,A=m-h+2*P,B=w-1+3*P,L=p-1+3*P,T=m-1+3*P,S=_[(u&=255)+M[(f&=255)+M[c&=255]]],W=_[u+n+M[f+s+M[c+i]]],v=_[u+o+M[f+a+M[c+h]]],C=_[u+1+M[f+1+M[c+1]]],k=.6-w*w-p*p-m*m,F=.6-g*g-x*x-y*y,O=.6-E*E-R*R-A*A,U=.6-B*B-L*L-T*T;return 32*((k<0?0:(k*=k)*k*S.dot(new b(w,p,m)))+(F<0?0:(F*=F)*F*W.dot(new b(g,x,y)))+(O<0?0:(O*=O)*O*v.dot(new b(E,R,A)))+(U<0?0:(U*=U)*U*C.dot(new b(B,L,T))))}function v(t){return t*t*t*(t*(6*t-15)+10)}function C(t){return new g(S(t.x,t.y),S(t.x+5*Math.PI,t.y+8*Math.PI))}const k="#version 300 es\\nprecision highp float;\\nin vec2 a_p; in vec2 a_c; uniform vec2 u_R; out vec2 v_tex; void main() { gl_Position = vec4((a_p / u_R * 2.0) - 1.0, 0.0, 1.0); v_tex = a_c; }";function F(t){const e=t.getContext("webgl2",{preserveDrawingBuffer:!0});if(e)if(e.getExtension("EXT_color_buffer_float")){if(e.getExtension("OES_texture_float_linear"))return e.pixelStorei(e.UNPACK_ALIGNMENT,1),e;alert("read_f32")}else alert("write_f32");else alert("webgl2")}function O(t,e,r){const n=t.createShader(e);return t.shaderSource(n,r),t.compileShader(n),t.getShaderParameter(n,t.COMPILE_STATUS)?n:(t.deleteShader(n),null)}function U(t,e,r){const n=t.createProgram();return t.attachShader(n,e),t.attachShader(n,r),t.linkProgram(n),t.getProgramParameter(n,t.LINK_STATUS)?n:(t.deleteProgram(n),null)}function D(t,e,r,n,s,i,o){const a=t.createTexture();return t.bindTexture(t.TEXTURE_2D,a),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texImage2D(t.TEXTURE_2D,0,n,e,r,0,s,i,o),a}function G(t,e,r,n,s){const i=t.createBuffer();return t.bindBuffer(t.ARRAY_BUFFER,i),t.bufferData(t.ARRAY_BUFFER,new Float32Array([e,r,n,r,e,s,e,s,n,r,n,s]),t.STATIC_DRAW),i}function N(t,e,r){t.bindBuffer(t.ARRAY_BUFFER,r),t.enableVertexAttribArray(e);var n=t.FLOAT;t.vertexAttribPointer(e,2,n,!1,0,0)}function $(t){const e=Array(t[0].length*t.length);for(let r=0;r<t[0].length;r++)for(let n=0;n<t.length;n++)e[r*t.length+n]=t[n][r];return e}function Y(t){const e=Array(2*t.length);for(let r=0;r<t.length;r++)e[2*r]=t[r].x,e[2*r+1]=t[r].y;return e}class z{constructor(t,e,r,n){this.gl=t,this.width=e,this.height=r,this.texture=D(t,e,r,t.RGBA32F,t.RGBA,t.FLOAT,n),this.framebuffer=t.createFramebuffer(),t.bindFramebuffer(t.FRAMEBUFFER,this.framebuffer),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.texture,0)}read(){return this.texture}readFramebuffer(){return this.framebuffer}readPixels(t){return t=t??make4F32Buffer(this.width,this.height),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.readFramebuffer()),this.gl.readPixels(0,0,this.width,this.height,this.gl.RGBA,this.gl.FLOAT,t),t}write(){return this.framebuffer}}class X{constructor(t,e){this.pool=t,this.id=e}read(){return this.pool.getRead(this.id).read()}readFramebuffer(){return this.pool.getRead(this.id).readFramebuffer()}write(){return this.pool.getWrite(this.id).write()}flip(){this.pool.flip()}readPixels(t){return this.pool.getRead(this.id).readPixels(t)}}class H{constructor(t,e,r){this.gl=t,this.width=e,this.height=r,this.buffers=[new z(t,e,r,null)],this.writeIndex=0,this.owners=[],this.onLease=-1}add(t){return this.buffers.push(new z(this.gl,this.width,this.height,t)),this.owners.push(this.buffers.length-1),new X(this,this.owners.length-1)}getRead(t){return this.buffers[this.owners[t]]}getWrite(t){if(this.onLease>=0)throw new Error(`Illegal state: already on lease to ${this.onLease}`);return this.onLease=t,this.buffers[this.writeIndex]}flip(){if(this.onLease<0)throw new Error("Can\'t flip: no lease open");const t=this.owners[this.onLease];this.owners[this.onLease]=this.writeIndex,this.writeIndex=t,this.onLease=-1}}function q(t,e,r){const n=new Float32Array(t*e*4);return void 0!==r&&n.fill(r),n}function J(t,e,r,n){const{vertShader:s,width:i,height:o,posBuffer:a,coordBuffer:h}=n,l=U(t,s,O(t,t.FRAGMENT_SHADER,e)),u=t.createVertexArray();t.bindVertexArray(u),N(t,t.getAttribLocation(l,"a_p"),a),N(t,t.getAttribLocation(l,"a_c"),h);const f={program:l,width:i,height:o,vertexArray:u};for(const e of r)f[e]=t.getUniformLocation(l,e);return f}function V(t,e,r,n,s){return{vertShader:O(t,t.VERTEX_SHADER,k),width:e,height:r,posBuffer:G(t,0,0,e,r),coordBuffer:G(t,n.x,n.y,s.x,s.y)}}function Q(t,e,r){t.bindFramebuffer(t.FRAMEBUFFER,r),t.viewport(0,0,e.width,e.height),t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT),t.useProgram(e.program),t.bindVertexArray(e.vertexArray),e.u_R&&t.uniform2f(e.u_R,e.width,e.height)}function j(t){const[e,r,n,s]=t;return null==s?`rgb(${e},${r},${n})`:`rgba(${e},${r},${n},${s})`}function K(t){return t.map((t=>t/255)).map((t=>t<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)))}function Z(t){return t<.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055}function tt(t){return t.map(Z).map((t=>ht(Math.round(255*t),0,255)))}class et{constructor(t){if(!t?.length)throw new Error("srgbs missing");this.rgbs=t.map(K)}color(t){const e=this.rgbs.length;if(0===t)return tt(this.rgbs[0]);if(1===t)return tt(this.rgbs[e-1]);if(1===e)return tt(this.rgbs[0]);const r=Math.floor(t*(e-1)),n=r+1,s=t*(e-1)-r,[i,o,a]=this.rgbs[r],[h,l,u]=this.rgbs[n];return tt([ut(i,h,s),ut(o,l,s),ut(a,u,s)])}}function rt(t,...e){return"function"==typeof t?t(...e):t}function nt(t,e){const r=new URL(window.location.href);null==e?r.searchParams.delete(t):r.searchParams.set(t,e),history.replaceState(null,null,r)}function st(t){const e=new URL(window.location.href);for(const[r,n]of Object.entries(t))null==n?e.searchParams.delete(r):e.searchParams.set(r,n);window.location.href=e}function it(t){const e=new URL(window.location.href).searchParams;return null==t?e:e.get(t)}function ot(t=null,e=null,r="main",n=!1){t=t??window.innerWidth,e=e??window.innerHeight;var s=document.createElement("canvas");return s.id=r,s.width=t,s.height=e,s.style.width=t,s.style.height=e,n&&(s.style.visibility="hidden",s.style.position="absolute",s.style.top="0",s.style.left="0"),document.body.appendChild(s),s}function at(t,e="download"){const r=document.createElement("a");r.setAttribute("download",e),t.toBlob((t=>{r.setAttribute("href",URL.createObjectURL(t)),r.click()}))}function ht(t,e,r){return Math.max(e,Math.min(r,t))}function lt(t){return t<0?-1:0===t?0:1}function ut(t,e,r){return"number"==typeof t?t*(1-r)+e*r:t.lerpT(e,r)}function ft(t,e,r){return(r-t)/(e-t)}function ct(t,e=3){const r=10**e;return Math.round(t*r)/r}function dt(t,e){return Math.pow(4*e*(1-e),t)}function wt(t,e,r,n){const{fill:s,stroke:i,lineCap:o,strokeWidth:a,lineJoin:h}=n;t.fillStyle=s,t.strokeStyle=i,t.lineCap=o,t.lineJoin=h,t.lineWidth=a,t.beginPath(),t.moveTo(e.x,e.y),t.lineTo(r.x,r.y),s&&t.fill(),i&&t.stroke()}function pt(t,e,r,n){const{fill:s,stroke:i,lineCap:o,strokeWidth:a,lineJoin:h}=n;t.fillStyle=s,t.strokeStyle=i,t.lineCap=o,t.lineJoin=h,t.lineWidth=a,t.beginPath(),t.arc(e.x,e.y,r,0,2*Math.PI),s&&t.fill(),i&&t.stroke()}function mt(t,e,r){const{fill:n,stroke:s,lineCap:i,strokeWidth:o,lineJoin:a}=r;t.fillStyle=n,t.strokeStyle=s,t.lineCap=i,t.lineJoin=a,t.lineWidth=o,(n||s)&&t.beginPath();let h=!0;for(const r of e)h?(t.moveTo(r.x,r.y),h=!1):t.lineTo(r.x,r.y);n&&t.fill(),s&&t.stroke()}const gt={B0:[[11,25,116],[10,27,120],[8,30,124],[7,33,128],[5,37,134],[3,41,140],[3,47,148],[3,56,158],[3,69,172],[23,97,196]],B1:[[3,40,138],[3,46,147],[3,53,155],[3,60,163],[3,68,171],[3,77,180],[11,88,189],[30,103,200],[59,125,214],[147,189,240]],B2:[[71,135,219],[76,139,221],[82,143,223],[88,148,225],[96,153,228],[105,160,230],[116,168,233],[131,178,237],[153,193,241],[211,230,248]],Y1:[[235,117,3],[243,132,4],[249,145,22],[254,157,36],[255,168,49],[255,178,62],[255,188,76],[255,197,92],[255,205,113],[255,211,144]],Y2:[[255,208,73],[255,209,80],[255,210,86],[255,211,94],[255,213,101],[255,214,109],[255,215,118],[255,217,129],[255,219,141],[255,221,157]],P1:[[252,180,177],[252,183,180],[253,186,183],[253,190,186],[253,194,190],[254,198,195],[254,203,200],[254,210,207],[254,218,215],[254,233,230]],P2:[[230,154,174],[231,157,176],[233,161,180],[234,165,183],[235,170,187],[237,175,192],[239,182,197],[241,190,204],[244,202,213],[248,222,228]],R1:[[214,44,15],[217,54,36],[219,63,50],[222,73,63],[224,82,75],[227,92,87],[229,103,100],[232,117,116],[234,134,136],[235,161,170]],G1:[[3,89,110],[3,97,119],[3,105,129],[3,115,140],[3,125,151],[3,135,163],[3,147,174],[3,158,185],[3,167,193],[3,171,197]],G1B1:[[3,108,166],[3,114,165],[3,120,166],[3,127,168],[3,135,172],[3,144,177],[3,153,183],[3,161,190],[3,169,195],[3,171,197]],G2:[[3,140,168],[3,147,175],[3,155,182],[3,164,190],[3,173,199],[10,184,208],[73,196,217],[116,210,227],[159,224,236],[185,233,241]],PR1:[[45,33,44],[51,39,80],[55,45,98],[60,50,110],[64,55,120],[67,60,128],[71,65,136],[76,70,143],[81,77,151],[127,126,196]],PR2:[[120,18,51],[154,43,102],[170,61,125],[182,76,142],[191,91,155],[199,105,168],[207,121,180],[215,139,193],[226,164,210],[252,253,250]],R1Y1:[[229,90,83],[228,88,72],[228,86,62],[227,84,53],[226,84,45],[225,84,37],[224,87,29],[224,91,22],[225,101,13],[229,118,3]],P1Y1:[[229,136,179],[230,138,172],[231,141,155],[233,143,136],[235,145,120],[237,148,105],[240,151,93],[242,154,81],[244,158,71],[247,163,60]],W1:[[215,221,223],[217,222,224],[219,224,226],[221,226,227],[224,228,229],[227,231,231],[230,234,234],[234,237,237],[239,242,241],[252,253,250]],W2:[[255,245,196],[255,245,198],[255,245,201],[255,246,204],[255,247,208],[255,247,212],[255,248,216],[255,249,222],[255,250,230],[252,253,250]],GR1:[[144,169,190],[147,172,192],[151,175,194],[156,178,197],[161,182,200],[167,187,202],[174,192,206],[183,198,209],[195,206,214],[215,218,219]],PR1B1:[[148,37,93],[125,56,114],[120,66,127],[118,74,137],[117,80,144],[116,86,151],[115,91,157],[114,96,163],[112,102,170],[102,133,204]]},bt=[{bs:["W1","W2"],cs:["B","Y1","G1"],as:["R1"]},{bs:["W1"],cs:["B","W1","R1"],as:["B2"]},{bs:["W1","W2"],cs:["B","B1","R1"],as:["W2","W1"]},{bs:["W1","W2"],cs:["B","Y1","B1"],as:["R1","P1"]},{bs:["W1"],cs:["B","Y1","B1","R1"],as:["W1","G2"]},{bs:["W1"],cs:["Y1","R1","B","B1"],as:["W1","G2"]},{bs:["W1"],cs:["Y1","B1","B","R1"],as:["W1","G2"]},{bs:["W1"],cs:["Y1","B","W1"],as:["R1","B2"]},{bs:["W2"],cs:["Y1","B1","W2"],as:["B"]},{bs:["W1"],cs:["B","P1","Y1","W1"],as:["B1"]},{bs:["W2"],cs:["P2","Y1","W1"],as:["B","B1","B2"]},{bs:["W1"],cs:["PR1","B","Y1","G1"],as:["B"]},{bs:["W2"],cs:["G1","B","Y1","R1"],as:["B2"]},{bs:["W2"],cs:["G1","B","PR1","Y1"],as:["R1"]},{bs:["W2"],cs:["G1","B","R1","Y1"],as:["W1"]},{bs:["W2"],cs:["P1","G1","B"],as:["W2"]},{bs:["W2"],cs:["B","PR2","R1Y1"],as:["W2","B1"]},{bs:["W2"],cs:["PR2","B","R1Y1"],as:["W2","B1"]},{bs:["W1"],cs:["G1B1","B","R1Y1"],as:["W1"]},{bs:["W1"],cs:["G1B1","P1Y1","R1Y1","B"],as:["W1"]},{bs:["W2"],cs:["P1Y1","R1Y1","B"],as:["W1"]},{bs:["W2"],cs:["B","P1Y1","PR1B1"],as:["R1","W2"]},{bs:["W1"],cs:["B","G1B1","P1Y1","R1Y1"],as:["W1"]}],xt=f(0,bt.length),yt=p([[16,"FILLED"],[2,"MIXED"],[1,"STROKE"]]),Et=p([[3,"MONOTONIC"],[3,"TRIANGLE"],[1,"RANDOM"]]),Rt=p([[7,"SQUARE"],[1,"WIDE"],[1,"TALL"],[1,"NARROW_WIDE"],[1,"NARROW_TALL"]]),At=c(.7)&&("WIDE"===Rt||"TALL"===Rt),Mt=f(6,18),_t=f(10,70),Bt=d(["VERTICAL","HORIZONTAL","MIXED"]),Lt=d(["SMALL","MEDIUM","LARGE"]),Tt=d(["SMALL","MEDIUM","LARGE"]),It=p([[1,"SMALL"],[1,"MEDIUM"],[1,"LARGE"]]),Pt=d([1,2,3,4]),St=d([.5,1,2]),Wt=d(["CIRCLE","HALF_CIRCLE","SQUARE","HALF_SQUARE"]),vt=d([1,2]),Ct=Math.round(f(2,5)/vt),kt=Math.floor(Ct*u(.8,3)),Ft=f(35,51),Ot=f(60,81),Ut=p([[5,"ALL"],[1,"LOCAL"],[1,"GLOBAL"]]),Dt=u(.3,2),Gt=u(6.5,9.5),Nt=d(["NONE"]),$t=p([[10,"HIGH"],[1,"MIXED"]]),Yt=new Array(2*f(3,8)).fill(null).map(((t,e)=>e%2==0?Math.round(ut(3,6,Math.pow(u(),2))):Math.round(ut(4,20,Math.pow(u(),2))))),zt=Yt.reduce(((t,e)=>t+e),0),Xt=Ct*vt,Ht=5/Math.sqrt(Xt),qt=5/Math.sqrt(Xt),Jt=1024,Vt=-1,Qt=256;document.title=`Rhythm & the Machine (${r.hash.slice(0,8)}...)`,nt("hash",r.hash);const jt="#version 300 es\\nprecision highp float;\\n\\nuniform vec2 u_R; uniform sampler2D u_S0; in vec2 v_tex; out vec4 o_col; uniform int u_bs; uniform vec2 u_pts[256]; uniform vec2 u_ds[256]; uniform float u_rs[256]; uniform float u_ts;\\n\\nfloat cp(float w, float x) { x = abs(x); if (x >= w) { return 0.0; } x /= w; return 1.0 - x * x * (3.0 - 2.0 * x); }\\nvec2 pt(in vec2 st, in vec2 pos, in vec2 dir, in float rad, in float ts) { if ((st.x == -1.0 && st.y == -1.0) || rad <= 0.0) { return vec2(0.0, 0.0); } vec2 to_st = st - pos; float mag = cp(rad, length(to_st)); return dir * ts * mag * mag; }\\n\\nvoid main(void) {\\n vec4 p = texture(u_S0, v_tex); vec2 xy = p.xy; vec2 zw = p.zw; for (int i = 0; i < u_bs; i++) { xy += pt(xy, u_pts[i], u_ds[i], u_rs[i], u_ts); zw += pt(zw, u_pts[i], u_ds[i], u_rs[i], u_ts); } o_col = vec4(xy, zw);\\n}";class Kt{constructor(){const t=F(ot(10,10,"blobstore",!0));this.bufferPool=new H(t,Jt,Jt),this.pendingBuff=this.#e(),this.bufferSize=this.pendingBuff.length/2,this.writeIdx=0,this.completeBuffs=[],this.log=[],this.glState=this.#r(t)}#r(t){const e=V(t,1024,1024,new g,new g(1,1));return{gl:t,perturbShader:J(t,jt,["u_R","u_S0","u_pts","u_ds","u_rs","u_bs","u_ts"],e),width:1024,height:1024}}#n(t,e){const{gl:r,perturbShader:n}=this.glState;let{pts:s,dirs:i,rads:o,batchSize:a,ts:h}=e;s=Y(s),i=Y(i);const l=n,u=t.read();Q(r,l,t.write()),r.uniform1i(l.u_S0,0),r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,u),r.uniform2fv(n.u_pts,s),r.uniform2fv(n.u_ds,i),r.uniform1fv(n.u_rs,o),r.uniform1i(n.u_bs,a),r.uniform1f(n.u_ts,h),r.drawArrays(r.TRIANGLES,0,6),t.flip()}#e(){return q(Jt,Jt,Vt)}#s(t=new g(Vt,Vt)){this.writeIdx>=this.bufferSize&&this.commitBuff(),this.pendingBuff[2*this.writeIdx]=t.x,this.pendingBuff[2*this.writeIdx+1]=t.y,this.writeIdx++}status(){return`Storing ${this.completeBuffs.length} full buffer(s) with ${this.pendingBuff.length/2} point(s) each. Storing 1 partial buffer with ${this.writeIdx} points`}applyStirs(t,e,r=0,n=1){if(this.writeIdx>0)throw"Uncommitted data";if(r===n)return;const s=Array(Qt).fill(new g),i=Array(Qt).fill(new g),o=Array(Qt).fill(0);let a=0;const h=()=>{if(0===a)return;const t={pts:s,dirs:i,rads:o,ts:e,batchSize:a};for(const e of this.completeBuffs)this.#n(e,t);a=0},l=(t,e,r)=>{a===Qt&&h(),s[a]=t,i[a]=e,o[a]=r,a++};let u=r;for(;u<=n;){for(const e of t){const{pt:t,dir:r,mag:n,rad:s}=e.paramT(u);l(t,r.mul(n),s)}if(u===n)break;u=Math.min(1,u+e)}h()}addLine(t,e,r={}){t=new E(t),this.log.push({line:t,tl:t.tl(),br:t.br(),meta:r});for(let r=0;r<e;r++){const n=ht(r/(e-1),0,1),s=t.param(n);this.#s(s)}this.#s()}addCircle(t,e,r,n={},s=1){this.log.push({pt:t,rad:e,tl:t.sub(new g(e,e)),br:t.add(new g(e,e)),meta:n});const i=2*Math.PI/r,o=u(2*Math.PI),a=new g(e,0);for(let e=0;e<r*s;e++){const r=t.add(a.rotate(i*e+o));this.#s(r)}this.#s()}commitBuff(){if(0!==this.writeIdx){if(this.completeBuffs.length>1024)throw new Error("over 1024 buffs in use");this.completeBuffs.push(this.bufferPool.add(this.pendingBuff)),this.pendingBuff.fill(Vt),this.writeIdx=0}}readLines(t=.001){if(this.writeIdx>0)throw"Uncommitted data";const e=[];let r=[],n=0;const s=this.pendingBuff;let i,o=rt(t,this.log[n].meta);for(const a of this.completeBuffs){a.readPixels(s);for(let a=0;a<s.length-1;a+=2){const h=s[a],l=s[a+1];if(h===Vt&&l===Vt){if(0===r.length)break;e.push({line:r,meta:this.log[n].meta}),o=rt(t,this.log[n].meta),n++,r=[],i=void 0}else{const t=new g(h,l);(null==i||i.dist(t)>=o)&&(i=t,r.push(t))}}}return e}getBuffers(){if(this.writeIdx>0)throw"Uncommitted data";return[...this.completeBuffs]}}class Zt{constructor(){this.pts=[],this.mags=[],this.rads=[],this.open=!0}push(t,e,r){if(!this.open)throw"StirLine finalized";return this.pts.push(t),this.mags.push(e),this.rads.push(r),this}mapPt(t){const e=new Zt;for(let r=0;r<this.pts.length;r++)e.push(t(this.pts[r]),this.mags[r],this.rads[r]);return e}#i(t){const e=[],r=[],n=[];let i=0;const o=[0];for(let t=0;t<this.pts.length-1;t++)i+=this.pts[t].dist(this.pts[t+1]),o.push(i);const a=t=>{const[e,r]=s(o,t);if(r)return e;if(e>=this.pts.length-1)throw new Error(`${e} >= ${this.pts.length} - 1`);const n=o[e],i=o[e+1];return i===n?e:e+(t-n)/(i-n)};for(let s=0;s<t;s++){const h=a(s<t-1?i*s/(t-1):i)/o.length,{pt:l,mag:u,rad:f}=this.paramT(h);e.push(l),r.push(u),n.push(f)}this.pts=e,this.mags=r,this.rads=n}finalize(t){if(!this.open)throw"StirLine finalized";this.#i(t),this.dirs=[];for(let t=0;t<this.pts.length;t++){const e=Math.max(0,t-1),r=Math.min(this.pts.length-1,t+1),n=this.pts[e],s=this.pts[t],i=this.pts[r],o=n.dist(s)+s.dist(i),a=0===o?new g:i.sub(n).div(o);this.dirs.push(a)}return this.open=!1,this}#o(t){return{pt:this.pts[t],dir:this.dirs?.[t],mag:this.mags[t],rad:this.rads[t]}}paramT(t){if(t<0||t>1)throw new Error(`Out of range ${t.toPrecision(3)}`);if(0===t)return this.#o(0);if(1===t)return this.#o(this.pts.length-1);const e=t*(this.pts.length-1),r=Math.floor(e),n=e-r,s=this.#o(r),i=this.#o(r+1),o={};for(const[t,e]of Object.entries(s))null!=e&&(o[t]=ut(e,i[t],n));return o}}class te{constructor(t,e,r=3,n=[]){this.gen=t,this.rank=e,this.N=r,this.samples=n}sample(){let t,e=Number.MAX_VALUE;for(let r=0;r<this.N;r++){const r=this.gen(this.samples),n=this.samples.map((t=>this.rank(t,r))).reduce(((t,e)=>t+e),0);n<e&&(e=n,t=r)}return this.samples.push(t),t}}const ee=100;function re(t,e,r={}){let{freq:n,steps:s,minSteps:i,minDist:o,dt:a,octaves:h,damping:l,wind:u}=r;n??=1,s??=100,i??=3*s/4,o??=.1,a??=.01,h??=1,l??=.6,u??=new g;const f=y(new g,new g(1,1),t,e);let c,d,w=new g;for(let r=0;r<20;r++){let r=m();for(;!f(r).inRect(t,e);)r=m();c=new E([f(r)]);for(let i=0;i<s;i++){d=C(r.mul(n)).add(u).mul(a),w=w.add(d),r=r.add(w),w=w.mul(l);const s=f(r);if(!s.inRect(t,e))break;c.push(s)}if(c.dist()>o)return c.points}return c.points}function ne(t,e,r={}){let{mag:n,rad:s}=r;n??=.1,s??=.1,n=rt(n),s=rt(s);const i=new Zt,o=re(t,e,r),a=o.length;for(let t=0;t<a;t++){const e=o[t],r=t/Math.max(1,a-1),h=rt(n,r),l=rt(s,r);i.push(e,h,l)}return i}function se(t,e,r,n={}){const s=[];for(let i=0;i<r;i++)s.push(ne(t,e,n));return s}function*ie(t){if(!t?.length)for(;;)yield!0;let e=0,r=0,n=!0;for(;;){if(t[r]<=0)throw new Error("invalid");for(;e<t[r];)yield n,e++;n=!n,e=0,r=(r+1)%t.length}}function oe(t,e,r,n){let{mag:s,rad:i}=n;return se(t,e,r,{...n,mag:()=>{const t=u(.09,.11)*s;return e=>dt(1,e)*t},rad:()=>{const t=u(.03,.05)*i;return e=>dt(4,e)*t}})}function ae(t){const e=new g(0,t.y/2),r=new g(t.x,t.y/2),n=new g(t.x/2,0),s=new g(t.x/2,t.y),i=t.mul(.5);switch(Nt){case"NONE":return(t,e)=>e;case"FLIP":return(t,i)=>t%2==0?i:i.reflect(e,r).reflect(n,s);case"ROTATE":return(t,e)=>e.rotateAround(i,t*Math.PI/2);default:throw new Error(`Illegal transform: ${Nt}`)}}function he(t,e,r,n){const{count:s,reseed:i,mag:o,rad:a,freq:h,steps:l,octaves:f}=n,c=[],d=[],w=ae(r),p=(new g).lerpT(r,-.5),m=(new g).lerpT(r,1.5);for(let t=0;t<s;t++)d.push(...oe(p,m,1,{mag:o,rad:a,freq:h,steps:l,octaves:f,minDist:r.dist()/2})),null!=i&&t%i==0&&B(u());let b=t.y-r.y;const x=t.x-r.x;let y=0;for(;b<e.y+r.y;){let t=x;for(;t<e.x+r.x;){const e=new g(t,b);for(const t of d)c.push(t.mapPt((t=>w(y,t).add(e))));t+=r.x,y++}b+=r.y}return c}function le(){switch(Bt){case"VERTICAL":return!0;case"HORIZONTAL":return!1;case"MIXED":return c();default:throw new Error(`Illegal BLOB_FLIP type: ${Bt}`)}}function ue(){switch(Rt){case"SQUARE":return[new g,new g(1,1)];case"WIDE":return[new g(-.4,0),new g(1.4,1)];case"TALL":return[new g(0,-.4),new g(1,1.4)];case"NARROW_WIDE":return[new g(-.2,.45),new g(1.2,.55)];case"NARROW_TALL":return[new g(.45,-.2),new g(.55,1.2)];default:throw new Error(`Illegal GRID_SHAPE: ${Rt}`)}}function fe(t,e,r){let{dt:n,sampler:s,metaFn:i}=r;const o=s.sample(),a=Math.max(1,Math.round(e.x/n.x)),h=Math.max(1,Math.round(e.y/n.y));let l=0;const u=(e,r)=>{const s=o.add(new g(r*n.x,e*n.y)),u=i(l,e/(h-1),r/(a-1));if(l++,null==u)return;let c=u.radius;switch(Wt){case"CIRCLE":t.addCircle(s,c,2e5*c,u);break;case"HALF_CIRCLE":c*=Math.sqrt(2),t.addCircle(s,c,2e5*c,u,.5);break;case"SQUARE":c=2*c/Math.PI,t.addLine([s.add(new g(-c,-c)),s.add(new g(c,-c)),s.add(new g(c,c)),s.add(new g(-c,c)),s.add(new g(-c,-c))],2e5*c,u);break;case"HALF_SQUARE":c=2*c/Math.PI;const e=f(0,4)*Math.PI/2;t.addLine([s.add(new g(-c,-c)).rotateAround(s,e),s.add(new g(c,-c)).rotateAround(s,e),s.add(new g(c,c)).rotateAround(s,e),s.add(new g(-c,c)).rotateAround(s,e)],2e5*c,u);break;default:throw new Error(`Illegal BLOB_SHAPE: ${Wt}`)}};if(le())for(let t=0;t<h;t++)for(let e=0;e<a;e++)u(t,e);else for(let t=0;t<a;t++)for(let e=0;e<h;e++)u(e,t)}function ce(){const t={};for(const[e,r]of Object.entries(gt)){const n=new et(r);n.name=e,t[e]={gradient:n}}return t.B={gradient:new et([[0,0,1],[2,1,4]])},t}function de(t,e){const r=[],n={reseed:null,steps:Ft,mag:Ht,rad:qt,freq:Dt,count:Ct,octaves:1},s={reseed:null,steps:Ft,mag:.3*Ht,rad:.3*qt,freq:2*Dt,count:kt,octaves:1},i=ge();for(let o=0;o<vt;o++)r.push(...he(t,e,i,n)),r.push(...he(t,e,i,s));const o=e.lerpT(t,1.1),a=t.lerpT(e,1.1),h=o.sub(a),l=[],f=Math.max(4,Math.round(h.x*h.y*Gt));for(let r=0;r<f;r++)l.push(...oe(o,a,2,{mag:u(3.7,4.2),rad:u(5,6),freq:Dt,minDist:e.sub(t).dist()/3,steps:Math.floor(Ot),octaves:1})),B(u());for(const t of r)t.finalize(100);for(const t of l)t.finalize(100);switch(Ut){case"ALL":return[r,l];case"LOCAL":return[r];case"GLOBAL":return[l];default:throw new Error(`Illegal STIR_LAYERS type: ${Ut}`)}}function we(){const t=f(5,20),e=new Array(t).fill(null),r=c(),n=r?1:0,s=r?0:1;switch(Et){case"RANDOM":return e.map((()=>u()));case"MONOTONIC":return e.map(((e,r)=>ut(n,s,r/(t-1))));case"TRIANGLE":const r=f(2,t-1);return e.map(((e,i)=>ut(n,s,i<r?i/r:1-(i-r)/(t-r-1))));default:throw new Error(`Illegal type: ${Et}`)}}function pe(){const t=u(),e=u();switch(It){case"SMALL":return[ut(.015,.1,Math.pow(t,4)),ut(.2,.26,e)];case"MEDIUM":return[ut(.015,.1,Math.pow(t,3)),ut(.26,.32,e)];case"LARGE":return[ut(.015,.1,Math.pow(t,2)),ut(.32,.38,e)];default:throw new Error(`Illegal BLOB_SIZE: ${It}`)}}function me(){let t,e;switch(Tt){case"SMALL":t=.09,e=.13;break;case"MEDIUM":t=.13,e=.19;break;case"LARGE":t=.19,e=.25;break;default:throw new Error(`Illegal blobCellSize: ${Tt}`)}return m(new g(t,t),new g(e,e))}function ge(){let t,e;switch(Lt){case"SMALL":t=.15,e=.18;break;case"MEDIUM":t=.18,e=.21;break;case"LARGE":t=.21,e=.25;break;default:throw new Error(`Illegal stirCellSize: ${Lt}`)}return m(new g(t,t),new g(e,e))}function be(t,e,r,n){const s=Ee().map((t=>n[t])),i=n[Ae()],o=s.length,a=we(),h=(r.sub(e),me()),l=h.max(),d=h.mul(.5),w=new te((()=>m(h)),((t,e)=>e.dist(d)),Pt),p=St;let g=f(500);const b=ie(Yt),x=f(zt),[y,E]=pe();for(let t=0;t<x;t++)b.next();for(let e=0;e<Mt;e++){const n=e/(Mt-1),d=ut(y*l,E*l,Math.pow(1-n,p));s[e%o];let m=f(0,a.length);const x={radius:d,dt:h,metaFn:()=>{if(!b.next().value)return null;g++;const{gradient:t,fn:r}=g%_t==0?i:s[e%o];return{gradient:t,t:g%_t==0?u(.1):a[++m%a.length],t0:0,t1:1,radius:d*u(.5,2.1)}},sampler:w};fe(t,r,x),c(.1)&&fe(t,r,x),e>2*Mt/3&&fe(t,r,x)}t.commitBuff()}function xe(t,e,r,n){for(const{line:s,meta:i}of r){if(s.length<=2)continue;const{gradient:r,t:o,t0:a,t1:h,theta:l,radius:u}=i,f=j(r.color(ut(a,h,o))),c=j(r.color(ut(a,h,.2*o))),w=e(ut(.003,.008,ft(.01,.1,u)));let p;switch(s[0].dist(s.at(-1))<.001&&s.push(s[0]),yt){case"FILLED":p={fill:f};break;case"MIXED":p=d([{fill:c,strokeWidth:w,lineJoin:"round"},{stroke:c,fill:f,strokeWidth:w,lineJoin:"round"},{fill:f}]);break;case"STROKE":p={stroke:f,strokeWidth:1.5*w,lineJoin:"round"};break;default:throw new Error(`Illegal style: ${yt}`)}const m={strokeWidth:0,...p,fill:"white",stroke:"white"},g=n.get(r.name);if(null==g||o>.2){mt(t,s.map(e),p);for(const t of n.values())mt(t,s.map(e),m)}else{mt(g,s.map(e),p),mt(t,s.map(e),m);for(const t of n.keys())t!==r.name&&mt(n.get(t),s.map(e),m)}}}function ye(){switch($t){case"HIGH":return.001;case"MIXED":return()=>d([.001,.1]);default:throw new Error(`Illegal BLOB_TOLERANCE: ${$t}`)}}function Ee(){return bt[xt].cs}function Re(){return d(bt[xt].bs)}function Ae(){return d(bt[xt].as)}function Me(){l(2),B(u());const t=Math.min(window.innerWidth,window.innerHeight),n=t,s=ot(t,n,"mainCanvas"),i=s.getContext("2d");i.imageSmoothingEnabled=!1;const o=(it("skipColors")??"").split(",").filter((t=>t?.length>0)),a=new Map;for(const e of o){const r=ot(t,n,e);a.set(e,r.getContext("2d"))}const h=ot(t,n,"debug",!1),f=h.getContext("2d");f.fillStyle="white",f.fillRect(0,0,t,n);const[c,d]=ue(),w=new Kt,p=ce(),m=p[Re()].gradient.color(u(.9,1));l(10),be(w,c,d,p);const b=w.log.map((t=>t.tl)).reduce(((t,e)=>t.tl(e))),x=w.log.map((t=>t.br)).reduce(((t,e)=>t.br(e)));l(20);const E=de(b,x);for(const t of E)w.applyStirs(t,.02,0,1);const R=w.readLines(ye());R.sort(((t,e)=>t.t===e.t?t.radius-e.radius:e.t-t.t));const A=R.map((t=>t.line)).map((t=>t.reduce(((t,e)=>t.tl(e))))).reduce(((t,e)=>t.tl(e))),M=R.map((t=>t.line)).map((t=>t.reduce(((t,e)=>t.br(e))))).reduce(((t,e)=>t.br(e))),_=Math.min(t,n)/(At?-20:10),L=y(A,M,new g,new g(t,n),_);mt(i,[new g,new g(t,0),new g(t,n),new g(0,n)],{fill:j(m)});for(const e of a.values())mt(e,[new g,new g(t,0),new g(t,n),new g(0,n)],{fill:"white"});l(30),xe(i,L,R,a),_e(f,w,E,L),window.addEventListener("keydown",(t=>{"d"===t.key?at(s,`rhythm_${r.hash}`):"b"===t.key?at(h,`rhythm_debug_${r.hash}`):"u"===t.key?url.set(params,nt):"f"===t.key?st({hash:e()}):"n"===t.key&&st(url.set({hash:e()},{}))}))}function _e(t,e,r,n){const s=n(.002),i=r.flat();function o(t){if(t.pts.length<2)return null;const e=t.pts[t.pts.length-1],r=t.pts[t.pts.length-2].sub(e).normalize(),i=r.rotate(.4),o=r.rotate(-.4);return[n(e).add(i.mul(7*s)),n(e).add(o.mul(7*s)),n(e).add(r.mul(-s))]}for(const r of e.log){let{line:e,pt:i,rad:o,meta:a}=r;const{gradient:h,t:l,t0:u,t1:f}=a,c=h.color(l);if(t.strokeStyle=j(c),t.fillStyle=j([...c]),t.lineWidth=2*s,t.beginPath(),null==e)i=n(i),o=n(o),t.arc(i.x,i.y,o,0,2*Math.PI);else{let r=!0;for(let s of e.points)s=n(s),r?t.moveTo(s.x,s.y):t.lineTo(s.x,s.y),r=!1}t.fill(),t.stroke()}i.map((t=>t.mags.reduce(Math.max))).reduce(Math.max);for(const e of i){t.beginPath(),t.lineCap="round",t.strokeStyle="#ffffff66",t.lineWidth=n(e.rads[0]);for(let r=0;r<e.pts.length;r++){const s=n(e.pts[r]);e.mags[r],n(e.rads[r]);0===r?t.moveTo(s.x,s.y):t.lineTo(s.x,s.y)}t.strokeStyle="#ffffff",t.lineWidth=4*s,t.stroke();const r=o(e);if(null!=r){const[e,n,i]=r;mt(t,[e,n,i,e],{stroke:"white",lineWidth:4*s,lineJoin:"round"})}}for(const e of i){const r={strokeWidth:s,stroke:"black"};mt(t,e.pts.map(n),r);const i=o(e);if(null!=i){const[e,n,s]=i;mt(t,[e,n,s],{fill:r.stroke})}}}Me();\n    <\/script>\n  </body>\n</html>\n'))),(0,s.kt)("p",null,"Convenient properties about the above example:"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"All code is contained in one file"),(0,s.kt)("li",{parentName:"ul"},"Javascript is inlined and minified"),(0,s.kt)("li",{parentName:"ul"},"No external resources are imported or required"),(0,s.kt)("li",{parentName:"ul"},"All code executes client side (no server required beyond static file storage)"),(0,s.kt)("li",{parentName:"ul"},"The size of the code is small enough to viably be written into storage directly on Ethereum (see ",(0,s.kt)("strong",{parentName:"li"},(0,s.kt)("a",{parentName:"strong",href:"./code-size-guidelines"},"code size guidelines")),")")),(0,s.kt)("p",null,"Since all code runs client side, we can provide users with a direct link to live generation, hosted on IPFS: ",(0,s.kt)("strong",{parentName:"p"},(0,s.kt)("a",{parentName:"strong",href:"https://ipfs.io/ipfs/QmWCYYop3pCNmvTsuByn6JDkiQYqdmzBXcaixC5aw1vMz2/?hash=0x0631538ac57af3bc8d21a2dfe0cb7100c91fcdb5d6d2477ac15a0c25d8804d68"},"https://ipfs.io/ipfs/QmWCYYop3pCNmvTsuByn6JDkiQYqdmzBXcaixC5aw1vMz2/?hash=0x0631538ac57af3bc8d21a2dfe0cb7100c91fcdb5d6d2477ac15a0c25d8804d68"))),(0,s.kt)("p",null,'As you can see from this live generation link, we are also able to pass a particular token\'s "seed" into the URL as a URL parameter (as ',(0,s.kt)("inlineCode",{parentName:"p"},"hash"),") in order to generate the same image that a particular token has."),(0,s.kt)("p",null,"We can also query the entire code shown above, directly via Ethereum (set _startIndex to ",(0,s.kt)("inlineCode",{parentName:"p"},"0"),"): ",(0,s.kt)("strong",{parentName:"p"},(0,s.kt)("a",{parentName:"strong",href:"https://etherscan.io/address/0x914b4f3b3c6cff9dc7ae25f368abbb5520f90efa#readContract#F9"},"https://etherscan.io/address/0x914b4f3b3c6cff9dc7ae25f368abbb5520f90efa#readContract#F9"))))}f.isMDXComponent=!0}}]);